
<!DOCTYPE html><html lang="pt-br"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Gestﾃ｣o Pro Enterprise - v6.9 Full</title>    <script src="https://cdn.tailwindcss.com"></script>    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">    <style>        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }        .glass-card { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 1.5rem; transition: all 0.2s ease; position: relative; }        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; font-weight: 800; }        .critical-stock { border-left: 8px solid #ef4444 !important; background: #fef2f2; }        .delete-btn { position: absolute; top: 1.5rem; right: 1.5rem; color: #cbd5e1; transition: color 0.2s; cursor: pointer; }        .delete-btn:hover { color: #ef4444; }        #register-modal { display: none; }        @media print {             .no-print { display: none !important; }             .print-only { display: block !important; }             body { background: white; padding: 0; }             .glass-card { border: 1px solid #eee !important; box-shadow: none !important; break-inside: avoid; }             main { padding: 0 !important; }        }        .print-only { display: none; }    </style></head><body class="text-slate-800">    <div id="auth-screen" class="fixed inset-0 z-[9999] bg-slate-900 flex items-center justify-center p-4">        <div class="bg-white w-full max-w-md p-10 rounded-[2.5rem] shadow-2xl text-center">            <div class="w-20 h-20 bg-blue-600 rounded-2xl mx-auto flex items-center justify-center shadow-lg mb-8">                <i class="fas fa-rocket text-white text-3xl"></i>            </div>            <h2 class="text-3xl font-black text-slate-900 tracking-tight">Ativaﾃｧﾃ｣o Enterprise</h2>            <div class="space-y-4 my-8">                <input type="text" id="auth-doc" maxlength="14" class="w-full p-5 bg-slate-100 rounded-2xl text-center text-lg font-bold outline-none border-2 border-transparent focus:border-blue-500 transition-all" placeholder="CPF ou CNPJ">                <input type="password" id="license-key" class="w-full p-5 bg-slate-100 rounded-2xl text-center text-xl font-bold uppercase outline-none border-2 border-transparent focus:border-blue-500 transition-all" placeholder="CHAVE DE ACESSO">            </div>            <button onclick="handleLogin()" id="btn-login-fire" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl transition-all uppercase text-xs tracking-widest mb-4">Ativar Sistema</button>            <button onclick="document.getElementById('register-modal').style.display = 'flex'" class="text-blue-600 font-bold text-[10px] uppercase tracking-widest hover:underline">Primeiro Acesso? Criar Senha</button>        </div>    </div>    <div id="register-modal" class="fixed inset-0 z-[10000] bg-slate-900/90 flex items-center justify-center p-4">        <div class="bg-white w-full max-w-md p-10 rounded-[2.5rem] shadow-2xl">            <h3 class="text-2xl font-black mb-6 text-center italic text-slate-900">Criar Meu Acesso</h3>            <div class="space-y-4">                <input type="text" id="reg-doc" class="w-full p-4 bg-slate-100 rounded-xl font-bold" placeholder="CPF/CNPJ Autorizado">                <input type="password" id="reg-key" class="w-full p-4 bg-slate-100 rounded-xl font-bold" placeholder="Crie sua Senha">                <button onclick="handleRegister()" id="btn-reg" class="w-full bg-green-600 text-white font-black py-4 rounded-xl uppercase text-xs">Validar e Cadastrar</button>                <button onclick="document.getElementById('register-modal').style.display = 'none'" class="w-full text-slate-400 font-bold text-[10px] uppercase mt-2">Cancelar</button>            </div>        </div>    </div>    <div id="app-content" class="hidden">        <nav class="bg-white border-b border-slate-100 sticky top-0 z-40 shadow-sm no-print">            <div class="max-w-6xl mx-auto px-6 flex justify-between items-center h-24">                <div class="flex items-center gap-4">                    <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center shadow-md"><i class="fas fa-rocket text-white text-xl"></i></div>                    <div><span class="font-black text-2xl italic block leading-none tracking-tighter">GESTﾃグ<span class="text-blue-600">PRO</span></span>                        <div class="flex items-center gap-2 mt-1"><span id="user-id-display" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">ID: ----</span><span id="days-left" class="bg-blue-100 text-blue-600 text-[9px] px-2 py-0.5 rounded-full font-black uppercase">365 DIAS</span></div>                    </div>                </div>                <div class="flex gap-4 h-full items-center">                    <div class="flex gap-6 text-[11px] font-black uppercase text-slate-400 mr-4">                        <button onclick="switchTab('dash')" id="tab-dash" class="h-full px-2 tab-active">Dashboard</button>                        <button onclick="switchTab('inventory')" id="tab-inventory" class="h-full px-2">Estoque</button>                        <button onclick="switchTab('recipes')" id="tab-recipes" class="h-full px-2">Ficha Tﾃｩcnica</button>                    </div>                    <button onclick="generatePDFReport()" class="flex items-center gap-2 bg-slate-900 text-white px-4 py-2.5 rounded-full text-[10px] font-black uppercase hover:scale-105 transition-all shadow-lg">                        <i class="fas fa-file-pdf"></i><span>PDF de Performance</span>                    </button>                    <button onclick="sendWhatsAppReport()" class="flex items-center gap-2 bg-green-50 text-green-600 px-4 py-2.5 rounded-full text-[10px] font-black uppercase border border-green-200 hover:bg-green-600 hover:text-white transition-all shadow-sm group">                        <i class="fab fa-whatsapp text-sm group-hover:scale-110"></i><span>WhatsApp</span>                    </button>                    <button onclick="closeDay()" class="bg-red-600 text-white px-4 py-2.5 rounded-xl text-[9px] font-black uppercase hover:bg-red-700 transition-colors shadow-lg">Fechar Dia</button>                    <button onclick="handleLogout()" class="text-slate-300 hover:text-red-500 transition-colors ml-2"><i class="fas fa-power-off text-lg"></i></button>                </div>            </div>        </nav>        <main class="max-w-6xl mx-auto p-6 space-y-8 pb-32">            <div id="section-dash" class="space-y-8">                <div id="pdf-header" class="print-only text-center border-b-4 border-blue-600 pb-6 mb-8">                    <h1 class="text-3xl font-black italic">GESTﾃグ PRO <span class="text-blue-600">ENTERPRISE</span></h1>                    <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mt-2">Relatﾃｳrio Executivo de Alta Performance</p>                    <p id="pdf-date-display" class="text-sm font-black mt-4"></p>                </div>                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">                    <div class="glass-card p-6 border-b-4 border-b-blue-500"><p class="text-[10px] font-black uppercase text-slate-400">Vendas Hoje</p><h3 id="m-sales" class="text-3xl font-black">R$ 0,00</h3></div>                    <div class="glass-card p-6 border-b-4 border-b-red-500"><p class="text-[10px] font-black uppercase text-slate-400">Custo Materiais</p><h3 id="m-costs" class="text-3xl font-black text-red-500">R$ 0,00</h3></div>                    <div class="glass-card p-6 border-b-4 border-b-green-500"><p class="text-[10px] font-black uppercase text-slate-400">Lucro Bruto Hoje</p><h3 id="m-profit" class="text-3xl font-black text-green-600">R$ 0,00</h3></div>                    <div class="glass-card p-6 border-b-4 border-b-amber-500">                        <p class="text-[10px] font-black uppercase text-slate-400">Pendente Break-Even</p>                        <h3 id="m-be" class="text-xl font-black">R$ 0,00</h3><span id="m-be-percent" class="text-[10px] font-bold bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full mt-2 inline-block">Faltam 100%</span>                        <div class="w-full bg-slate-100 h-2 mt-4 rounded-full overflow-hidden no-print"><div id="be-progress" class="bg-amber-500 h-full w-0 transition-all"></div></div>                    </div>                </div>                <div id="pdf-monthly-summary" class="print-only grid grid-cols-3 gap-6 mb-8">                    <div class="glass-card p-6 border-l-4 border-blue-900 bg-slate-50"><p class="text-[9px] font-black uppercase">Acumulado Vendas (30d)</p><h4 id="pdf-month-sales" class="text-xl font-black">R$ 0,00</h4></div>                    <div class="glass-card p-6 border-l-4 border-red-900 bg-slate-50"><p class="text-[9px] font-black uppercase">Acumulado Custos (30d)</p><h4 id="pdf-month-costs" class="text-xl font-black">R$ 0,00</h4></div>                    <div class="glass-card p-6 border-l-4 border-green-900 bg-slate-50"><p class="text-[9px] font-black uppercase">Lucro Lﾃｭquido (30d)</p><h4 id="pdf-month-profit" class="text-xl font-black">R$ 0,00</h4></div>                </div>                <div class="glass-card p-8 bg-slate-900 text-white border-none shadow-2xl no-print">                    <h4 class="font-black text-xs uppercase mb-6 text-blue-400 italic">Venda Automﾃ｡tica (Ficha Tﾃｩcnica)</h4>                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">                        <select id="sel-product-sale" class="bg-slate-800 p-4 rounded-xl text-sm font-bold border border-slate-700 outline-none text-white"></select>                        <input type="number" id="prod-sale-qty" class="bg-slate-800 p-4 rounded-xl text-sm font-bold border border-slate-700 outline-none text-white" placeholder="Qtd Vendida">                        <button onclick="sellProduct()" class="bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black uppercase text-xs transition-all shadow-lg">Confirmar e Baixar</button>                    </div>                </div>                <div class="glass-card shadow-sm overflow-hidden border border-slate-100">                    <div class="p-8 border-b flex flex-wrap gap-6 justify-between items-center bg-white">                        <h4 class="font-black text-xs uppercase italic tracking-tighter text-blue-600">Detalhamento de Insumos (Saﾃｭdas)</h4>                        <div class="flex flex-wrap gap-3 items-center no-print">                            <select id="sel-insumo" class="bg-slate-50 p-3.5 rounded-xl text-xs font-bold outline-none min-w-[180px] border border-slate-100"></select>                            <input type="number" id="usage-qty" class="bg-slate-50 text-xs p-3.5 w-20 rounded-xl outline-none font-black border border-slate-100" placeholder="Qtd.">                            <select id="usage-unit" class="bg-slate-50 p-3.5 rounded-xl text-[10px] font-black text-blue-600 uppercase border border-slate-100"><option value="g">G</option><option value="kg">KG</option><option value="ml">ML</option><option value="L">L</option><option value="un">UN</option></select>                            <button onclick="addUsage()" class="bg-blue-600 text-white w-14 h-14 rounded-xl shadow-lg flex items-center justify-center hover:scale-105 transition-transform"><i class="fas fa-plus"></i></button>                        </div>                    </div>                    <div class="overflow-x-auto"><table class="w-full text-sm"><thead class="bg-slate-50 text-slate-400 font-black text-[10px] uppercase border-b"><tr><th class="px-8 py-5 text-left">Insumo / Referﾃｪncia</th><th class="px-8 py-5 text-left">Quantidade</th><th class="px-8 py-5 text-right">Custo na Operaﾃｧﾃ｣o</th><th class="px-8 py-5 text-center no-print">Aﾃｧﾃ｣o</th></tr></thead><tbody id="usage-list" class="divide-y"></tbody></table></div>                </div>                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">                    <div class="lg:col-span-2 space-y-8">                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">                            <div class="glass-card p-8"><h4 class="font-black text-xs uppercase mb-6 text-slate-400 tracking-widest">Evoluﾃｧﾃ｣o Lucro</h4><div class="h-64"><canvas id="mainChart"></canvas></div></div>                            <div class="glass-card p-8"><h4 class="font-black text-xs uppercase mb-6 text-slate-400 tracking-widest">Proporﾃｧﾃ｣o (30 dias)</h4><div class="h-64"><canvas id="pizzaChart"></canvas></div></div>                        </div>                        <div class="glass-card p-8 no-print">                            <div class="flex justify-between items-center mb-6"><h4 class="font-black text-xs uppercase text-blue-600 tracking-widest">Histﾃｳrico de Fechamentos</h4><button onclick="clearHistory()" class="text-[9px] font-black uppercase bg-slate-100 hover:bg-red-50 hover:text-red-500 px-3 py-1.5 rounded-lg transition-all border border-slate-200">Limpar</button></div>                            <div class="overflow-x-auto"><table class="w-full"><thead class="text-[10px] uppercase text-slate-400 border-b"><tr><th class="text-left py-4">Data</th><th class="text-right py-4">Vendas</th><th class="text-right py-4">Custos</th><th class="text-right py-4">Lucro</th></tr></thead><tbody id="history-list" class="text-sm font-bold divide-y"></tbody></table></div>                        </div>                    </div>                    <div class="space-y-6 no-print">                        <div class="glass-card p-8 bg-slate-900 text-white border-none shadow-2xl relative overflow-hidden"><h4 class="font-black text-[10px] mb-6 opacity-50 uppercase">Venda Manual (Dinheiro)</h4><input type="number" id="sale-val" class="w-full bg-transparent border-b-2 border-slate-700 text-4xl font-black text-white outline-none" placeholder="0,00"><button onclick="addSale()" class="w-full bg-blue-600 hover:bg-blue-500 py-5 mt-6 rounded-2xl font-black uppercase text-xs shadow-lg">Somar Caixa</button></div>                        <div class="glass-card p-6"><h4 class="font-black text-[10px] text-slate-400 mb-4 uppercase">Meta Fixa</h4><div class="flex gap-2"><input type="number" id="cfg-fixed" class="w-full bg-slate-50 p-4 rounded-xl text-sm font-bold outline-none border border-slate-100" placeholder="Meta Mensal"><button onclick="saveConfig()" class="bg-slate-800 text-white px-6 rounded-xl font-black text-[10px] uppercase">Salvar</button></div></div>                    </div>                </div>            </div>            <div id="section-inventory" class="hidden space-y-8">                <div class="glass-card p-8 shadow-sm no-print">                    <h4 class="font-black mb-8 uppercase text-xs text-blue-600 tracking-widest">Cadastro de Estoque</h4>                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">                        <input type="text" id="inv-name" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-sm border border-slate-100" placeholder="Nome Insumo">                        <div class="flex gap-2"><input type="number" id="inv-qty" class="p-4 bg-slate-50 rounded-2xl w-full font-bold text-sm border border-slate-100" placeholder="Qtd Total"><select id="inv-unit" class="p-4 bg-slate-50 rounded-2xl text-[10px] font-black uppercase border border-slate-100"><option value="kg">KG</option><option value="L">L</option><option value="un">UN</option></select></div>                        <input type="number" id="inv-price" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-sm border border-slate-100" placeholder="Preﾃｧo Total Pago">                        <button onclick="saveInventory()" class="w-full h-[58px] bg-blue-600 text-white font-black rounded-2xl text-[10px] uppercase shadow-lg">Cadastrar</button>                    </div>                </div>                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="inventory-grid"></div>            </div>            <div id="section-recipes" class="hidden space-y-8">                <div class="glass-card p-8 shadow-sm no-print">                    <h4 class="font-black mb-8 uppercase text-xs text-blue-600 tracking-widest">Montagem de Receitas</h4>                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">                        <input type="text" id="rec-name" class="p-4 bg-slate-50 rounded-2xl font-bold text-sm border border-slate-100" placeholder="Nome do Produto">                        <input type="number" id="rec-price" class="p-4 bg-slate-50 rounded-2xl font-bold text-sm border border-slate-100" placeholder="Preﾃｧo de Venda">                    </div>                    <div class="p-6 bg-blue-50 rounded-2xl mb-6">                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">                            <select id="sel-ingrediente" class="p-4 bg-white rounded-xl text-sm font-bold border border-blue-100"></select>                            <div class="flex gap-2"><input type="number" id="rec-ing-qty" class="p-4 bg-white rounded-xl w-full text-sm font-bold border border-blue-100" placeholder="Qtd"><select id="rec-ing-unit" class="p-4 bg-white rounded-xl text-[10px] font-black uppercase border border-blue-100"><option value="g">G</option><option value="ml">ML</option><option value="un">UN</option></select></div>                            <button onclick="addIngToTemp()" class="bg-blue-600 text-white rounded-xl font-black text-[10px] uppercase">Vincular</button>                        </div>                        <div id="temp-ing-list" class="mt-4 flex flex-wrap gap-2"></div>                    </div>                    <button onclick="saveFullRecipe()" id="btn-save-recipe" class="w-full py-5 bg-slate-900 text-white rounded-2xl font-black uppercase text-xs shadow-xl tracking-widest">Salvar Produto</button>                </div>                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="recipes-grid"></div>            </div>        </main>    </div>    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] opacity-0 transition-all pointer-events-none"><div class="bg-slate-900 text-white px-10 py-5 rounded-2xl text-xs font-black uppercase shadow-2xl" id="toast-msg"></div></div>    <script type="module">        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";        const firebaseConfig = { apiKey: "AIzaSyCboQje-660NNTe90tmS-HxF7_7hmTAhg4", authDomain: "gestorpro-fda39.firebaseapp.com", projectId: "gestorpro-fda39", storageBucket: "gestorpro-fda39.firebasestorage.app", messagingSenderId: "614355486570", appId: "1:614355486570:web:ec1b6f76020cde55b68713" };        const fbApp = initializeApp(firebaseConfig);        const db = getFirestore(fbApp);        const DB_KEY = "GP_V69_CORRECTED";        let myChart = null; let myPizza = null;        let state = { license: "", storeDoc: "", startDate: null, inventory: {}, recipes: {}, dailyUsage: [], dailySales: 0, fixedCost: 0, currentFixedLeft: 0, historyLog: [] };        let tempIngredients = [];

        window.handleLogin = async function() {            const btn = document.getElementById('btn-login-fire');            const key = document.getElementById('license-key').value.trim().toUpperCase();            const docInput = document.getElementById('auth-doc').value.trim().replace(/\D/g, '');            if (docInput.length < 11 || key.length < 3) return alert("Preencha tudo!");            btn.innerText = "VERIFICANDO..."; btn.disabled = true;            try {                const docSnap = await getDoc(doc(db, "lincencas", docInput));                if (docSnap.exists() && docSnap.data().key === key) {                    const dadosSnap = await getDoc(doc(db, "dados_usuarios", docInput));                    if (dadosSnap.exists()) { state = {...state, ...dadosSnap.data()}; }                     state.license = key; state.storeDoc = docInput; state.startDate = state.startDate || new Date().getTime();                    saveData(); unlockApp(); initChart(); render();                } else { alert("Dados incorretos."); }            } catch (e) { alert("Erro conexﾃ｣o."); } finally { btn.innerText = "Ativar Sistema"; btn.disabled = false; }        };        window.unlockApp = function() { document.getElementById('auth-screen').style.display = 'none'; document.getElementById('app-content').classList.remove('hidden'); checkExpiration(); };        window.checkExpiration = function() { const d = Math.floor((new Date().getTime() - state.startDate) / 86400000); document.getElementById('days-left').innerText = `${365 - d} DIAS RESTANTES`; };        window.saveData = function() { localStorage.setItem(DB_KEY, JSON.stringify(state)); };        window.syncToCloud = async function() { if (state.storeDoc) await setDoc(doc(db, "dados_usuarios", state.storeDoc), state); };

        window.saveInventory = function() {            const name = document.getElementById('inv-name').value.trim().toUpperCase();            const qty = parseFloat(document.getElementById('inv-qty').value);            const unit = document.getElementById('inv-unit').value;            const price = parseFloat(document.getElementById('inv-price').value);            if (!name || isNaN(qty) || isNaN(price)) return;            let baseQty = (unit === 'kg' || unit === 'L') ? qty * 1000 : qty;            let baseUnit = (unit === 'kg' ? 'g' : (unit === 'L' ? 'ml' : 'un'));            if (!state.inventory[name]) state.inventory[name] = { stock: 0, pricePerBase: 0, unit: baseUnit, originalUnit: unit };            const item = state.inventory[name];            item.stock += baseQty;            item.pricePerBase = price / baseQty;            item.fullUnitPrice = price / qty;            saveData(); render(); syncToCloud(); showToast("Estoque Atualizado!");        };

        window.deleteInventoryItem = function(name) { if(confirm(`Excluir ${name}?`)) { delete state.inventory[name]; saveData(); render(); syncToCloud(); } };

        window.addIngToTemp = function() {            const name = document.getElementById('sel-ingrediente').value;            const qty = parseFloat(document.getElementById('rec-ing-qty').value);            const unit = document.getElementById('rec-ing-unit').value;            if (!name || isNaN(qty)) return;            tempIngredients.push({ id: Date.now(), name, qty, unit });            renderTempIng();        };

        window.removeIngFromTemp = function(id) { tempIngredients = tempIngredients.filter(i => i.id !== id); renderTempIng(); };

        window.renderTempIng = function() {            document.getElementById('temp-ing-list').innerHTML = tempIngredients.map(i => `                <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-[10px] font-bold flex items-center gap-2">                    ${i.name} ${i.qty}${i.unit}                    <button onclick="removeIngFromTemp(${i.id})" class="hover:text-red-300"><i class="fas fa-times"></i></button>                </span>            `).join('');        };

        window.saveFullRecipe = function() {            const name = document.getElementById('rec-name').value.trim().toUpperCase();            const price = parseFloat(document.getElementById('rec-price').value);            if (!name || isNaN(price) || tempIngredients.length === 0) return alert("Ficha tﾃｩcnica vazia!");            state.recipes[name] = { price, ingredients: [...tempIngredients] };            tempIngredients = [];             document.getElementById('rec-name').value = "";            document.getElementById('rec-price').value = "";            document.getElementById('temp-ing-list').innerHTML = "";            saveData(); render(); syncToCloud(); showToast("Produto Salvo!");        };

        // FUNﾃﾃグ DE EDIﾃﾃグ CORRIGIDA
        window.editRecipe = function(name) {            const recipe = state.recipes[name];            if (!recipe) return;            document.getElementById('rec-name').value = name;            document.getElementById('rec-price').value = recipe.price;            tempIngredients = [...recipe.ingredients];            renderTempIng();            window.scrollTo({ top: 0, behavior: 'smooth' });            showToast("Editando: " + name);        };

        window.generatePDFReport = function() {            const dateStr = new Date().toLocaleString('pt-BR');            document.getElementById('pdf-date-display').innerText = `DATA: ${dateStr}`;            const mSales = state.historyLog.reduce((a, b) => a + b.sales, 0);            const mCosts = state.historyLog.reduce((a, b) => a + b.costs, 0);            const mProfit = state.historyLog.reduce((a, b) => a + b.profit, 0);            document.getElementById('pdf-month-sales').innerText = formatBRL(mSales);            document.getElementById('pdf-month-costs').innerText = formatBRL(mCosts);            document.getElementById('pdf-month-profit').innerText = formatBRL(mProfit);            window.print();        };

        window.sellProduct = function() {            const prodName = document.getElementById('sel-product-sale').value;            const qtyVendida = parseFloat(document.getElementById('prod-sale-qty').value);            if (!prodName || isNaN(qtyVendida)) return;            const recipe = state.recipes[prodName];            recipe.ingredients.forEach(ing => {                const item = state.inventory[ing.name];                if (item) {                    let totalToDeduct = (ing.unit === 'g' || ing.unit === 'ml') ? ing.qty * qtyVendida : ing.qty * qtyVendida;                    item.stock -= totalToDeduct;                    state.dailyUsage.push({ id: Date.now(), name: ing.name, qty: totalToDeduct, unit: item.unit, cost: totalToDeduct * item.pricePerBase });                }            });            state.dailySales += (recipe.price * qtyVendida);            saveData(); render(); syncToCloud(); showToast("Baixa e Venda Concluﾃｭdas!");        };

        window.addUsage = function() {            const name = document.getElementById('sel-insumo').value;            const qty = parseFloat(document.getElementById('usage-qty').value);            const unit = document.getElementById('usage-unit').value;            if (!name || isNaN(qty)) return;            let baseQty = (unit === 'kg' || unit === 'L') ? qty * 1000 : qty;            const item = state.inventory[name];            if (baseQty > item.stock) return alert("Estoque insuficiente!");            item.stock -= baseQty;            state.dailyUsage.push({ id: Date.now(), name, qty, unit, cost: baseQty * item.pricePerBase });            saveData(); render(); syncToCloud(); showToast("Uso Manual Registrado!");        };

        window.addSale = function() { const v = parseFloat(document.getElementById('sale-val').value); if (isNaN(v)) return; state.dailySales += v; saveData(); render(); syncToCloud(); document.getElementById('sale-val').value = ""; };        window.saveConfig = function() { state.fixedCost = parseFloat(document.getElementById('cfg-fixed').value) || 0; state.currentFixedLeft = state.fixedCost; saveData(); render(); syncToCloud(); };        window.closeDay = function() {            const tc = state.dailyUsage.reduce((a, b) => a + b.cost, 0); const tp = state.dailySales - tc;            state.currentFixedLeft = Math.max(0, state.currentFixedLeft - tp);            state.historyLog.unshift({ date: new Date().toLocaleDateString('pt-BR'), sales: state.dailySales, costs: tc, profit: tp });            state.dailySales = 0; state.dailyUsage = []; saveData(); render(); syncToCloud(); showToast("Dia Encerrado!");        };

        window.render = function() {            const tc = state.dailyUsage.reduce((a, b) => a + b.cost, 0); const tp = state.dailySales - tc;            document.getElementById('m-sales').innerText = formatBRL(state.dailySales);            document.getElementById('m-costs').innerText = formatBRL(tc);            document.getElementById('m-profit').innerText = formatBRL(tp);            document.getElementById('m-be').innerText = formatBRL(state.currentFixedLeft);            const beP = state.fixedCost > 0 ? Math.min(100, (tp / state.fixedCost) * 100) : 0;            document.getElementById('be-progress').style.width = beP + '%';            document.getElementById('m-be-percent').innerText = `Faltam ${Math.max(0, 100-beP).toFixed(0)}%`;            const selIns = document.getElementById('sel-insumo'); const selIng = document.getElementById('sel-ingrediente');            selIns.innerHTML = selIng.innerHTML = '<option value="">Selecionar Insumo...</option>';            Object.keys(state.inventory).sort().forEach(n => { selIns.innerHTML += `<option value="${n}">${n}</option>`; selIng.innerHTML += `<option value="${n}">${n}</option>`; });            const selProd = document.getElementById('sel-product-sale'); selProd.innerHTML = '<option value="">Escolher Produto...</option>';            Object.keys(state.recipes).sort().forEach(n => selProd.innerHTML += `<option value="${n}">${n}</option>`);            document.getElementById('inventory-grid').innerHTML = Object.entries(state.inventory).map(([n, d]) => `<div class="glass-card p-6 ${d.stock < 500 ? 'critical-stock' : 'border-t-4 border-blue-500'}"><button onclick="deleteInventoryItem('${n}')" class="delete-btn no-print"><i class="fas fa-times-circle"></i></button><h4 class="font-black text-[10px] uppercase text-slate-400">${n}</h4><p class="text-2xl font-black">${Math.round(d.stock)}<small class="text-xs ml-1 opacity-50">${d.unit}</small></p><p class="text-[10px] font-bold text-green-600 mt-1">Custo: ${formatBRL(d.fullUnitPrice)}/${d.originalUnit || 'un'}</p></div>`).join('');            document.getElementById('usage-list').innerHTML = state.dailyUsage.map(u => `<tr><td class="px-8 py-4 font-bold text-xs">${u.name}</td><td class="px-8 py-4 text-xs">${u.qty}${u.unit}</td><td class="px-8 py-4 text-right text-red-500 font-black">${formatBRL(u.cost)}</td><td class="px-8 py-4 text-center no-print"><button onclick="deleteUsage(${u.id})" class="text-slate-300 hover:text-red-500"><i class="fas fa-trash"></i></button></td></tr>`).join('');            document.getElementById('recipes-grid').innerHTML = Object.entries(state.recipes).map(([n, r]) => `<div class="glass-card p-6 border-t-4 border-slate-900 no-print"><div class="flex justify-between items-start"><h4 class="font-black text-xs uppercase">${n}</h4><button onclick="editRecipe('${n}')" class="text-blue-500 hover:text-blue-700 transition-colors"><i class="fas fa-edit text-sm"></i></button></div><p class="text-green-600 font-black">${formatBRL(r.price)}</p><p class="text-[10px] text-slate-400 mt-2">${r.ingredients.length} Itens na Ficha</p></div>`).join('');            document.getElementById('history-list').innerHTML = state.historyLog.map(h => `<tr><td class="py-4 text-slate-500">${h.date}</td><td class="py-4 text-right">${formatBRL(h.sales)}</td><td class="py-4 text-right text-red-400">${formatBRL(h.costs)}</td><td class="py-4 text-right text-green-600">${formatBRL(h.profit)}</td></tr>`).join('');            document.getElementById('user-id-display').innerText = `ID: ${state.storeDoc.slice(-4)}`; updateChart();        };

        window.sendWhatsAppReport = function() {            const tc = state.dailyUsage.reduce((a, b) => a + b.cost, 0); const tp = state.dailySales - tc;            const msg = `噫 *GESTﾃグ PRO - ALTA PERFORMANCE*%0A` + `套 *HOJE:* ${formatBRL(state.dailySales)} (LUCRO: ${formatBRL(tp)})%0A` + `識 *BE:* ${formatBRL(state.currentFixedLeft)}%0A` + `_Enviado via Enterprise_`;            window.open(`https://wa.me/?text=${msg}`);        };

        window.initChart = function() {            myChart = new Chart(document.getElementById('mainChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [{ label: 'Lucro Diﾃ｡rio', data: [], borderColor: '#3b82f6', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false } });            myPizza = new Chart(document.getElementById('pizzaChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Custos', 'Lucro'], datasets: [{ data: [0, 0], backgroundColor: ['#ef4444', '#22c55e'] }] }, options: { responsive: true, maintainAspectRatio: false } });            updateChart();        };

        window.updateChart = function() {            if (!myChart || !myPizza) return;            const lastData = [...state.historyLog].slice(0, 30).reverse();            if (lastData.length > 0) {                myChart.data.labels = lastData.map(d => d.date.split('/')[0]);                myChart.data.datasets[0].data = lastData.map(d => d.profit);                const tc = lastData.reduce((a, b) => a + b.costs, 0); const tp = lastData.reduce((acc, h) => acc + h.profit, 0);                myPizza.data.datasets[0].data = [tc, tp];            }            myChart.update(); myPizza.update();        };

        window.deleteUsage = function(id) { const idx = state.dailyUsage.findIndex(x => x.id === id); if (idx > -1) { const u = state.dailyUsage[idx]; if (state.inventory[u.name]) state.inventory[u.name].stock += (u.unit === 'kg' || u.unit === 'L' ? u.qty * 1000 : u.qty); state.dailyUsage.splice(idx, 1); saveData(); render(); } };        window.clearHistory = () => { if (confirm("Limpar?")) { state.historyLog = []; saveData(); render(); } };        window.formatBRL = v => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);        window.showToast = m => { const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = m; t.classList.remove('opacity-0'); setTimeout(() => t.classList.add('opacity-0'), 2000); };        window.switchTab = t => { ['dash', 'inventory', 'recipes'].forEach(s => document.getElementById('section-'+s).classList.toggle('hidden', s !== t)); ['dash', 'inventory', 'recipes'].forEach(s => document.getElementById('tab-'+s).classList.toggle('tab-active', s === t)); };        window.handleLogout = () => { localStorage.removeItem(DB_KEY); location.reload(); };        window.onload = () => { const saved = localStorage.getItem(DB_KEY); if (saved) { state = JSON.parse(saved); if (state.license) unlockApp(); initChart(); render(); } };    </script></body></html>
